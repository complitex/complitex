<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.complitex.organization.service.ServiceBillingBean">
    <resultMap id="serviceBillingResultMap" type="org.complitex.organization.entity.ServiceBilling">
        <id column="id" property="id"/>
        <result column="service_id" property="serviceId"/>
        <result column="billing_id" property="billingId"/>
    </resultMap>

    <select id="getServiceBillings" parameterType="map" resultMap="serviceBillingResultMap">
        SELECT * FROM `service_billing` WHERE `id` IN
        <foreach collection="ids" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </select>

    <insert id="insertServiceBilling" parameterType="org.complitex.organization.entity.ServiceBilling"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `service_billing` (`service_id`, `billing_id`)
          VALUES (#{serviceId}, #{billingId})
    </insert>

    <delete id="deleteServiceAssociations" parameterType="map">
        DELETE FROM `service_billing` WHERE `id` IN
        (SELECT a.`value_id` FROM `organization_attribute` a WHERE a.`object_id` = #{objectId}
        AND a.`attribute_type_id` = #{organizationServiceBillingAT})
    </delete>

</mapper>
